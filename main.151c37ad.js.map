{"version":3,"sources":["js/modules/serverComm.js","js/modules/helpers.js","js/modules/gameField.js","js/main.js"],"names":["serverComm","gameURL","URL","fieldData","response","fetch","method","body","JSON","stringify","result","json","document","querySelector","removeElem","elemClass","remove","setSessionGridArray","array","sessionStorage","setItem","getSessionGridArray","parse","getItem","Cell","x","y","z","value","generateField","elemCoefficient","fieldSize","gridArray","i","j","k","push","drawGrid","field","fieldWidth","offsetWidth","fieldHeight","offsetHeight","cellWidth","toFixed","cellHeight","Math","sqrt","divElem","createElement","className","innerHTML","cellClass","posX","posY","centerX","centerY","length","append","updateCells","dataArray","forEach","element","data","hexGridArray","initField","inputRadius","parseInt","getRowArray","axis","index","rowArray","getMovedRow","direction","initialArray","filteredInitArr","filter","elem","valuesArray","map","countZeroes","zeroesArray","Array","fill","newArray","moveArr","entries","getCalculatedRow","initArr","getUpdate","fieldRadius","indexArr","movedHexGridArray","calculatedHexGridArray","updatedHexGridArray","indexVal","movedRow","calculatedRow","baseURL","initialDataReq","target","reqURL","then","logKey","e","console","log","code","getDirection","addEventListener","closest"],"mappings":"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","file":"main.151c37ad.js","sourceRoot":"..","sourcesContent":["let gameURL;\r\n\r\nasync function serverComm(URL, fieldData) {\r\n  gameURL = URL;\r\n  let response = await fetch(URL, {\r\n    method: \"POST\",\r\n    body: JSON.stringify(fieldData),\r\n  });\r\n\r\n  let result = await response.json();\r\n  // console.log(result);\r\n  return result;\r\n}\r\n\r\n\r\n\r\nexport default serverComm;\r\n","const body = document.querySelector(\"body\");\r\n\r\nfunction removeElem(elemClass) {\r\n  if (!!body.querySelector(elemClass)) {\r\n    body.querySelector(elemClass).remove();\r\n  }\r\n}\r\n\r\nfunction setSessionGridArray(array) {\r\n  sessionStorage.setItem(\"hexGridArray\", JSON.stringify(array));\r\n}\r\n\r\nfunction getSessionGridArray() {\r\n  return JSON.parse(sessionStorage.getItem(\"hexGridArray\"));\r\n}\r\n\r\nexport { removeElem, setSessionGridArray, getSessionGridArray };\r\n","import {\r\n  removeElem,\r\n  setGridArray,\r\n  getGridArray\r\n} from \"./helpers\";\r\n\r\nfunction Cell(x, y, z, value) {\r\n  this.x = x;\r\n  this.y = y;\r\n  this.z = z;\r\n  this.value = value;\r\n}\r\n\r\nfunction generateField(elemCoefficient) {\r\n  const fieldSize = elemCoefficient;\r\n  const gridArray = [];\r\n\r\n  for (let i = -fieldSize; i < fieldSize + 1; i += 1) {\r\n    for (let j = -fieldSize; j < fieldSize + 1; j += 1) {\r\n      for (let k = -fieldSize; k < fieldSize + 1; k += 1) {\r\n        if (i + j + k == 0) {\r\n          gridArray.push(new Cell(i, j, k, 0));\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // console.log(gridArray);\r\n  return gridArray;\r\n}\r\n\r\nfunction drawGrid(gridArray, elemCoefficient) {\r\n  const field = document.querySelector(\".game-field\");\r\n  const fieldWidth = field.offsetWidth;\r\n  const fieldHeight = field.offsetHeight;\r\n\r\n  const elemRadius = elemCoefficient * 2 - 1;\r\n  const cellSize = fieldWidth / (elemCoefficient * 4 + 1);\r\n\r\n  const cellWidth = (cellSize * 2).toFixed(2);\r\n  const cellHeight = ((cellWidth * Math.sqrt(3)) / 2).toFixed(2);\r\n  const divElem = document.createElement(\"div\");\r\n  divElem.className = \"hex-grid\";\r\n  divElem.innerHTML = ``;\r\n\r\n  let cellClass = \"css-2\";\r\n\r\n  switch (elemCoefficient) {\r\n    case 2:\r\n      cellClass = \"css-3\";\r\n      break;\r\n    case 3:\r\n      cellClass = \"css-4\";\r\n  }\r\n\r\n  let x, y, z, value;\r\n  let posX, posY;\r\n  let centerX = fieldWidth / 2;\r\n  let centerY = fieldHeight / 2;\r\n\r\n  for (let i = 0; i < gridArray.length; i++) {\r\n    [x, y, z, value] = [\r\n      gridArray[i].x,\r\n      gridArray[i].y,\r\n      gridArray[i].z,\r\n      gridArray[i].value,\r\n    ];\r\n    posX = (x * 3 * cellWidth) / 4 + centerX - cellWidth / 2;\r\n    posY = ((-y + z) * cellHeight) / 2 + centerY - cellHeight / 2;\r\n    divElem.innerHTML += `\r\n    <div class=\"${cellClass}\" \r\n      data-value=\"${value}\" \r\n      data-x=\"${x}\" \r\n      data-y=\"${y}\" \r\n      data-z=\"${z}\" \r\n      style=\"left: ${posX}px; top: ${posY}px;\">${value || \"\"}</div>\r\n    `;\r\n  }\r\n  removeElem(\".hex-grid\");\r\n  field.append(divElem);\r\n}\r\n\r\nfunction updateCells(gridArray, dataArray) {\r\n  gridArray.forEach((element) => {\r\n    dataArray.forEach((data) => {\r\n      const result =\r\n        element.x === data.x && element.y === data.y && element.z === data.z;\r\n      if (!!result) {\r\n        element.value = data.value;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nlet elemCoefficient = 1;\r\nlet hexGridArray = [];\r\n\r\nfunction initField(inputRadius, data) {\r\n  elemCoefficient = parseInt(inputRadius) - 1;\r\n  hexGridArray = generateField(elemCoefficient);\r\n  updateCells(hexGridArray, data);\r\n  // setGridArray(hexGridArray);\r\n  drawGrid(hexGridArray, elemCoefficient);\r\n  return hexGridArray;\r\n}\r\n\r\nfunction getRowArray(axis, index, array) {\r\n  const rowArray = [];\r\n  array.forEach((element) => {\r\n    if (element[axis] === index) {\r\n      rowArray.push(element);\r\n    }\r\n  });\r\n  return rowArray;\r\n}\r\n\r\n// **\r\n// direction Boolean  - true for positive / false for negative\r\n\r\nfunction getMovedRow(rowArray, direction) {\r\n  const initialArray = [...rowArray];\r\n  const filteredInitArr = initialArray.filter(elem => elem.value > 0);\r\n  const valuesArray = filteredInitArr.length && filteredInitArr.map(elem => elem.value) || [];\r\n  const countZeroes = initialArray.length - valuesArray.length;\r\n  const zeroesArray = new Array(countZeroes).fill(0);\r\n  let newArray;\r\n  if (!direction) {\r\n    newArray = [...valuesArray, ...zeroesArray];\r\n  } else {\r\n    newArray = [...zeroesArray, ...valuesArray];\r\n  }\r\n  const moveArr = [...rowArray];\r\n  for (const [index, value] of moveArr.entries()) {\r\n    value.value = newArray[index];\r\n  }\r\n  return moveArr;\r\n}\r\n\r\nfunction getCalculatedRow(rowArray, direction) {\r\n  const initArr = [...rowArray];\r\n  // console.log(`111: ${JSON.stringify(initArr)}`);\r\n  if (direction) {\r\n    for (let i = initArr.length - 1; i > 0; i--) {\r\n      if (initArr[i].value === initArr[i - 1].value) {\r\n        initArr[i].value += initArr[i - 1].value;\r\n        initArr[i - 1].value = 0;\r\n      }\r\n    }\r\n  } else {\r\n    for (let i = 1; i < initArr.length; i++) {\r\n      if (initArr[i - 1].value === initArr[i].value) {\r\n        initArr[i - 1].value += initArr[i].value;\r\n        initArr[i].value = 0;\r\n      }\r\n    }\r\n  }\r\n  // console.log(`222: ${JSON.stringify(initArr)}`);\r\n  return initArr;\r\n}\r\n\r\nfunction getUpdate(axis, fieldRadius, direction) {\r\n  const indexArr = [];\r\n  for (let i = -fieldRadius + 1; i < fieldRadius; i++) {\r\n    indexArr.push(i);\r\n  }\r\n  let movedHexGridArray = [];\r\n  let calculatedHexGridArray = [];\r\n  let updatedHexGridArray = [];\r\n\r\n  for (let indexVal of indexArr) {\r\n    let rowArray = getRowArray(axis, indexVal, hexGridArray);\r\n    let movedRow = getMovedRow(rowArray, direction);\r\n    movedHexGridArray.push(...movedRow);\r\n  }\r\n\r\n  for (let indexVal of indexArr) {\r\n    let rowArray = getRowArray(axis, indexVal, movedHexGridArray);\r\n    let calculatedRow = getCalculatedRow(rowArray, direction);\r\n    calculatedHexGridArray.push(...calculatedRow);\r\n  }\r\n\r\n  for (let indexVal of indexArr) {\r\n    let rowArray = getRowArray(axis, indexVal, calculatedHexGridArray);\r\n    let movedRow = getMovedRow(rowArray, direction);\r\n    updatedHexGridArray.push(...movedRow);\r\n  }\r\n\r\n  hexGridArray = updatedHexGridArray;\r\n\r\n  // console.log(`333: ${JSON.stringify(hexGridArray)}`);\r\n  // console.log(`444: ${JSON.stringify(updatedHexGridArray)}`);\r\n  drawGrid(hexGridArray, elemCoefficient);\r\n  return hexGridArray;\r\n}\r\n\r\nexport {\r\n  initField,\r\n  updateCells,\r\n  drawGrid,\r\n  getUpdate\r\n};\r\n","import serverComm from \"./modules/serverComm\";\r\nimport {\r\n  initField as gameField,\r\n  getUpdate\r\n} from \"./modules/gameField\";\r\n\r\nconst baseURL = \"http://51.15.207.127:13337\";\r\nlet fieldData = [];\r\nlet fieldRadius;\r\nlet hexGridArray = [];\r\n\r\nconst body = document.querySelector(\"body\");\r\nbody.addEventListener(\"click\", function (e) {\r\n  const target = e.target;\r\n  if (!!target.closest(\".radius-btn\")) {\r\n    fieldRadius = target.value;\r\n    initialDataReq(target);\r\n  }\r\n});\r\n\r\nfunction initialDataReq(target) {\r\n  const reqURL = `${baseURL}/${target.value}`;\r\n\r\n  serverComm(reqURL, fieldData).then((result) =>\r\n    hexGridArray = gameField(target.value, result)\r\n  );\r\n}\r\n\r\nfunction logKey(e) {\r\n  console.log(e.code);\r\n}\r\n\r\nfunction getDirection(e) {\r\n  logKey(e);\r\n  switch (e.code) {\r\n    case \"KeyW\":\r\n      // direction = \"x+\";\r\n      hexGridArray = getUpdate(\"x\", fieldRadius, true);\r\n      break;\r\n    case \"KeyS\":\r\n      // direction = \"x-\";\r\n      hexGridArray = getUpdate(\"x\", fieldRadius, false);\r\n      break;\r\n    case \"KeyE\":\r\n      // direction = \"y+\";\r\n      hexGridArray = getUpdate(\"y\", fieldRadius, true);\r\n      break;\r\n    case \"KeyA\":\r\n      // direction = \"y-\";\r\n      hexGridArray = getUpdate(\"y\", fieldRadius, false);\r\n      break;\r\n    case \"KeyD\":\r\n      // direction = \"z+\";\r\n      hexGridArray = getUpdate(\"z\", fieldRadius, true);\r\n      break;\r\n    case \"KeyQ\":\r\n      // direction = \"z-\";\r\n      hexGridArray = getUpdate(\"z\", fieldRadius, false);\r\n      break;\r\n    default:\r\n      return;\r\n  }\r\n  console.log(JSON.stringify(hexGridArray));\r\n}\r\n\r\ndocument.addEventListener(\"keydown\", getDirection);\r\n\r\n"]}